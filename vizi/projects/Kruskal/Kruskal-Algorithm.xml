<?xml version="1.0" encoding="WINDOWS-1251"?>

<algorithm
>
    <variable
        description="Массив левых концов ребер"
        name="l"
        type="int[]"
        value="new int[4]"  
    />

    <variable
        description="Массив правых концов ребер"
        name="r"
        type="int[]"
        value="new int[4]"  
    />

    <variable
        description="Массив весов ребер"
        name="weights"
        type="int[]"
        value="new int[4]"  
    />

    <variable
            description="Текущее ребро"
            name="edgeMin"
            type="int"
            value="0"
    />


    <variable
        description="Цвета вершин"
        name="color"
        type="int[]"
        value="new int[5]"  
    />

     <variable
        description="Экземпляр визуализатора"
        name="visualizer"
        type="KruskalVisualizer"
        value="null"    
    />

    <data>
        <toString>
            return("");
        </toString>
    </data>

    <auto
        id="Main"
        description="Главный автомат"
    >
        <variable
            description="Переменная цикла"
            name="i"
            type="int"
        />

        <variable
            description="Количество выбранных ребер"
            name="m"
            type="int"
        />

        <start
            comment-ru="На экране изображен граф, в котором требуется 
                        найти дерево минимального веса"
            comment-en="There is a graph on the screen, minimal spannning
                        tree is needed to find in"
        >
            <draw>
                @visualizer.showWeights(true);
                @visualizer.updateView(-1, 0);
            </draw>
        </start>

        <call-auto
            id="Sort"
            level="1"
        />


        <step
            id="LoopInit"
            description="Инициализация цикла"
            level="0"
            comment-en="Creating empty forest"
            comment-ru="Создание пустого леса"
        >
            <draw>
                @visualizer.showWeights(false);    
                @visualizer.updateView(-1, 0);
            </draw>

            <action>
                @i @= 0;
            </action>   
        </step>

        <while  
            id="DSSInit"
            description="Инициализация системы непересекающихся множеств"
            test="@i &lt; @color.length"
            level="-1"
        >
            <step
                id="VertexInit"
                description="Инициализация вершины"
                level="-1"
            >
                <action>
                    @color[@i] @= @i;
                    @i @= @i + 1;
                </action>               
            </step>
        </while>

        <step
            id="mInit"
            description="Инициализация количества выбранных ребер нулем"
            level="-1"
        >
            <action>
                @m @= 0;
                @edgeMin @= 0;
            </action>
        </step>

        <while
            id="AddEdges"
            description="Добавление ребер в каркас"
            level="-1"
            test="@edgeMin &lt; @l.length"
        >
            <if
                id="cond"
                description="Проверка ребра"
                level="0"
                test="@color[@l[@edgeMin]] != @color[@r[@edgeMin]]"
                true-comment-ru="Ребро может быть добавлено к лесу,
                        потому, что соединяет вершины,
                        принадлежащие разным компонентам связности"
                true-comment-en="Edge can be added to the forest, 
                        because it connects vertexes 
                        of different components"
                false-comment-en="Edge can not be added to the forest, because
                        because it connects vertxes of one component"
                false-comment-ru="Ребро не может быть добавлено к лесу,
                        так как соединяет вершины одной компоненты связности"   
            >
                <draw>
                    @visualizer.updateView(@edgeMin, 3);
                </draw>
                <then>
                    <call-auto
                        id="Join"
                        level="-1"
                    />
                    <step
                        id="AddEdge"
                        description="Добавление ребра"
                        level="0"
                        comment-en="Adding edge to the forest"
                        comment-ru="Добавление ребра к лeсу"
                    >
                        <draw>
                            @visualizer.updateView(@edgeMin, 1);
                        </draw>

                        <action>
                            @m @= @m + 1;
                        </action>
                    </step>
                </then>
            </if>

            <step
                id="NextEdge"
                description="Переход к следующему"
                level="-1"
            >
                <action>
                    @edgeMin @= @edgeMin + 1;
                </action>
            </step>
        </while>


        <if
            id="isFound"
            description="найдено ли дерево"
            level="0"
            test="@m == @color.length - 1"
            true-comment-en     ="Minimal spanning tree is found,
            					because number of added edges is enough(number of vertexes - 1)"
            false-comment-en    ="Minimal spanning tree is not found,
            					because number of added edges is not enough
            					(number of vertexes - 1)"
            true-comment-ru     = "Минимальное остовное дерево найдено, так как 
            					к лесу было добавлено достаточное количество ребер
            					(количество вершин - 1)"
            false-comment-ru    = "Минимальное остовное дерево не найдено, так как
            					к лесу не было добавлено достаточного количества ребер
            					(оличество вершин - 1)"
        >
            <draw>
                @visualizer.updateView(1000, 0);
            </draw>
            <then>
            </then>
        </if>

        <finish
            comment-en="Algorithm finished"
            comment-ru="Алгоритм завершен"
        >
           <draw>
                @visualizer.updateView(1000, 0);
            </draw>
        </finish>

    </auto>

    <auto
        id="Sort"
        description="Сортировка ребер по весам"
    >
        <variable
            description="Переменная цикла"
            name="i"
            type="int"
        />

        <variable
            description="Переменная цикла 2"
            name="j"
            type="int"
        />

        <variable
            description="Временная переменная"
            name="temp"
            type="int"
        />

        <step
            id="LoopInit"
            description="Инициализация цикла"
            level="-1"
        >
            <action>
                @i @= 0;
            </action>
        </step>

        <while
            id="loopI"
            description="Цикл по i"
            level="-1"
            test="@i &lt; @l.length"
        >
            <step
                id="init"
                description="init"
                level="-1"
            >
                <action>
                    @j @= @i + 1;
                </action>
            </step>

            <while
                id="loopJ"
                description="Цикл по j"
                level="-1"
                test="@j &lt; @l.length"
            >
                <if
                    id="SwapCondition"
                    description="Условие перестановки"
                    level="-1"
                    test="@weights[@i] &gt; @weights[@j]"
                >
                    <then>
                        <step
                            id="Swap"
                            description="Перестановка"
                            level="-1"
                        >
                            <action>
                                @temp @= @weights[@i];
                                @weights[@i] @= @weights[@j];
                                @weights[@j] @= @temp;
                                @temp @= @l[@i];
                                @l[@i] @= @l[@j];
                                @l[@j] @= @temp;
                                @temp @= @r[@i];
                                @r[@i] @= @r[@j];
                                @r[@j] @= @temp;
                            </action>
                        </step>
                    </then>
                </if>

                <step
                    id="IncrementJ"
                    description="Инкремент j"
                    level="-1"
                >
                    <action>
                        @j @= @j + 1;
                    </action>
                </step>

            </while>

            <step
                id="IncrementI"
                description="Инкремент i"
                level="-1"
            >
                <action>
                    @i @= @i + 1;
                </action>
            </step>
                
        </while>

        <step
            comment-ru="Сортировка ребер по весам"
            comment-en="Edges sorting by weights"
            description="Показ отсортированного списка"
        >
            <draw>
                @visualizer.showWeights(true);
                @visualizer.updateView(-1, 0);
            </draw>
            <action>
            </action>
        </step>

    </auto>

    <auto
        id="Join"
        description="Слияние компонент связности"
    >
        <variable
            description="Временная переменная"
            name="temp"
            type="int"
        />

        <variable
            description="Переменная цикла"
            name="i"
            type="int"
        />

        <step
            id="Init"
            description="Инициализация"
            level="-1"
        >
            <action>
                @i @= 0;
                @temp @= @color[@l[@edgeMin]];
            </action>
        </step>

        <while
            id="Loop"
            description="Проход по вершинам"
            level="-1"
            test="@i &lt; @color.length"
        >
            <if
                id="Condition"
                description="Условие перекраски"
                level="-1"
                test="@color[@i] == @temp"
            >
                <then>
                    <step
                        id="Paint"
                        description="Перекраска"
                        level = "-1"
                    >
                        <action>
                            @color[@i] @= @color[@r[@edgeMin]];
                        </action>                       
                    </step>
                </then>
            </if>
            <step
                id="Increment"
                description="Инкремент"
                level="-1"
            >
                <action>
                    @i @= @i + 1;
                </action>
            </step>
        </while>
    </auto>

</algorithm>
